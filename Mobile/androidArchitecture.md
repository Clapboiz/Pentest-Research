# TÌM HIỂU ANDROID ARCHITECTURE
| Android architecture

| Thực hiện: Clapboiz

| Cập nhập lần cuối: 6/10/2024
# MỤC LỤC
1. [Architecture](#1-architecture)

2. [Virtual Machine](#2-android-virtual-machine)

3. [Android Security Model](#3-android-security-model)

4. [References](#4-references)

# NỘI DUNG
## 1. ARCHITECTURE
### Nền tảng ứng dụng

| Aspect               | Native App                                       | Hybrid App                                         | Web App                                          |
|----------------------|--------------------------------------------------|----------------------------------------------------|--------------------------------------------------|
| **Platform Support** | Chạy riêng trên từng nền tảng (iOS, Android)     | Chạy trên nhiều nền tảng qua một mã nguồn          | Chạy trên trình duyệt, không phụ thuộc nền tảng   |
| **Performance**      | Cao (tận dụng tối đa tài nguyên thiết bị)        | Có thể gần bằng native (tùy thuộc vào framework)   | Thấp hơn (giới hạn tài nguyên trình duyệt)       |
| **User Experience**  | Mượt mà, native UI                               | Kém hơn native, tùy thuộc vào framework            | Phụ thuộc vào trình duyệt và kết nối mạng        |
| **Access to Device** | Toàn bộ API của hệ điều hành (camera, GPS,...)   | Hybrid apps có thể tận dụng nhiều API hơn thông qua các plugin, nhưng vẫn có giới hạn so với native apps.         | Hạn chế nhiều, chỉ có thể truy cập thông qua Web APIs|
| **Development Cost** | Cao (tốn kém nếu hỗ trợ đa nền tảng)             | Thấp hơn native (mã dùng chung cho nhiều nền tảng) | Thấp nhất (chỉ cần viết một lần)                  |
| **Updates**          | Cần tải lại từ store                             | Cần tải lại từ store                               | Cập nhật trực tiếp trên server                   |
| **Offline Capability** | Có khả năng, dữ liệu lưu trữ nội bộ            | Có khả năng, nhưng không bằng native               | Hạn chế, yêu cầu kết nối mạng; có thể dùng Service Workers                   |

### Ưu và Nhược điểm

| App Type   | Ưu điểm                                                                                     | Nhược điểm                                                                             |
|------------|---------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------|
| **Native** | Hiệu suất tốt, trải nghiệm người dùng cao, tận dụng tối đa tài nguyên của thiết bị          | Chi phí cao, thời gian phát triển lâu, yêu cầu mã nguồn riêng cho từng nền tảng        |
| **Hybrid** | Giảm chi phí phát triển và bảo trì, mã nguồn dùng chung, hỗ trợ đa nền tảng                 | Hiệu suất thấp hơn native, phụ thuộc vào plugin, trải nghiệm người dùng có thể giảm    |
| **Web**    | Chi phí thấp, dễ cập nhật, không yêu cầu cài đặt trên thiết bị                              | Hạn chế truy cập tài nguyên thiết bị, hiệu suất thấp hơn, phụ thuộc vào kết nối mạng    |

### Android dựa trên hệ điều hành Linux và được chia thành nhiều lớp chính
![image](https://github.com/user-attachments/assets/5d6a923d-2f46-4958-947e-22b61203db37)

![image](https://github.com/user-attachments/assets/a2ba133f-28f1-4353-ac27-0ec3d19575e0)

**Linux Kernel:** 

Android được xây dựng trên nền tảng Linux, cung cấp các dịch vụ cốt lõi như bảo mật, quản lý bộ nhớ, quản lý tiến trình, và quản lý thiết bị. Hoạt động như một lớp trừu tượng giữa phần cứng và các phần khác của software stack. 

**_Lưu ý rằng:_** Android dựa trên kernel Linux không phải là một hệ điều hành Linux.

**Libraries:**

Chạy ngầm trong hệ thống, viết bằng ngôn ngữ c/c++.  Có 4 loại libraries:
  
  1. Bionic Libc, system C libraries
  2. Function Libraries, supporting multimedia, web browser, SQLite...
  3. Native Servers
  4. Hardware Abstraction Libraries

### ANDROID RUNTIME
**Android Runtime (ART):**

ART là cốt lõi của android platform và là môi trường chạy ứng dụng, biên dịch mã từ dạng .dex (Dalvik Executable) thành mã máy giúp cải thiện hiệu suất.

Các thư viện Java lõi hỗ trợ hầu hết các chức năng cơ bản của ngôn ngữ Java, bao gồm các thư viện như `java.lang`, `java.util`, `java.io`, giúp xử lý các tác vụ như chuỗi, bộ sưu tập, và nhập xuất dữ liệu.

Mỗi ứng dụng Android chạy trong một tiến trình riêng và có một instance máy ảo Dalvik riêng. Điều này giúp các ứng dụng cách ly, không can thiệp vào nhau, và bảo vệ dữ liệu giữa các ứng dụng.

### APPLICATION FRAMEWORK
Cung cấp các dịch vụ API cho phép ứng dụng truy cập vào tính năng của thiết bị.

**Đơn giản hóa việc sử dụng lại các components:**

- Các ứng dụng có thể public một số tính năng để các ứng dụng khác truy cập và sử dụng lại. Ví dụ: một ứng dụng có thể cho phép ứng dụng khác truy cập ảnh hoặc danh bạ của nó.

**Tập hợp các services và systems:**

- Views System: Hệ thống hiển thị các thành phần giao diện như danh sách, ô nhập liệu, nút nhấn, và thậm chí là trình duyệt nhúng để hiển thị nội dung web.
- Content Providers: Cho phép ứng dụng truy cập dữ liệu của ứng dụng khác hoặc chia sẻ dữ liệu của chính mình. Ví dụ: truy cập dữ liệu từ danh bạ, thư viện ảnh, hoặc cơ sở dữ liệu.
- Resources Manager: Quản lý các tài nguyên không phải mã nguồn, như chuỗi văn bản, hình ảnh, màu sắc, và các file giao diện, giúp tách biệt mã nguồn và tài nguyên, dễ quản lý hơn.

**Các thành phần quản lý hệ thống:**

- Activity Manager: Quản lý vòng đời của ứng dụng và các activity, đảm bảo các ứng dụng được khởi chạy và chuyển đổi một cách mượt mà. Cung cấp khả năng điều hướng giữa các màn hình trong ứng dụng.
- Notification Manager: Cho phép các ứng dụng hiển thị thông báo trong thanh trạng thái, giúp người dùng nhận được cảnh báo hoặc cập nhật từ ứng dụng ngay cả khi ứng dụng đang chạy nền.

### APPLICATIONS
Tầng trên cùng bao gồm các ứng dụng của người dùng, các ứng dụng mặc định như điện thoại, tin nhắn, trình duyệt.

Các ứng dụng Android được phát triển sau sẽ được đặt cùng mức với những ứng dụng này

## 2. ANDROID VIRTUAL MACHINE
### Dalvik Virtual Machine (DVM)
Trước đây, Android sử dụng Dalvik Virtual Machine (DVM) để chạy các ứng dụng được biên dịch từ mã Java sang bytecode Dalvik, được lưu dưới dạng .dex. DVM được tối ưu hóa để chạy hiệu quả trên các thiết bị có bộ nhớ và CPU giới hạn, giúp giảm thiểu tài nguyên tiêu thụ.

### ART (Android Runtime) 
Với các phiên bản Android mới, DVM đã được thay thế bằng Android Runtime (ART), mang lại hiệu suất và khả năng tối ưu cao hơn nhờ khả năng biên dịch AOT (Ahead-of-Time). ART biên dịch mã một lần khi ứng dụng được cài đặt, không yêu cầu biên dịch lại trong thời gian chạy như DVM. Điều này giúp giảm thời gian khởi chạy và cải thiện hiệu suất ứng dụng đáng kể.

### Sandboxing và Isolation 
Mỗi ứng dụng trên Android chạy trong một máy ảo Dalvik hoặc ART riêng biệt, hoạt động cách ly và độc lập với các ứng dụng khác. Cơ chế sandbox này đảm bảo bảo mật, giúp hạn chế quyền truy cập vào dữ liệu hoặc tài nguyên hệ thống ngoài các quyền được cấp phép.
## 3. ANDROID SECURITY MODEL
### Application Sandboxing
Mỗi ứng dụng trên Android được gán một UID duy nhất tại thời điểm cài đặt và chạy dưới tiến trình độc lập, cô lập ở cả mức tiến trình và tập tin. Các UID này được lưu trong các tệp cấu hình hệ thống như `/data/system/packages.xml` và `/data/system/packages.list`, giúp đảm bảo mỗi ứng dụng chỉ có thể truy cập vào dữ liệu của riêng mình, tạo nên một cơ chế bảo mật mạnh mẽ giữa các ứng dụng​.

### Permission
Ứng dụng Android yêu cầu quyền hạn thông qua tệp `AndroidManifest.xml` và được quản lý bởi Package Manager. Các quyền hạn được phân thành nhiều mức bảo vệ, từ mức độ thấp như normal cho đến mức signatureOrSystem chỉ dành cho các ứng dụng hệ thống, nhằm đảm bảo dữ liệu nhạy cảm của người dùng được bảo vệ.

### Inter-Process Communication (IPC) và Binder
Android sử dụng Binder, một IPC độc quyền, để cho phép giao tiếp giữa các tiến trình một cách an toàn. Binder hoạt động như một capability-based security model, nghĩa là chỉ tiến trình nào sở hữu "Binder token" mới có quyền truy cập vào tài nguyên liên quan. Kiểm soát IPC chặt chẽ giúp bảo vệ quyền riêng tư và an toàn hệ thống​.

### Code Signing & Platform Key
Mọi ứng dụng Android đều phải được ký bằng chữ ký số để đảm bảo tính toàn vẹn và nguồn gốc của ứng dụng. Các ứng dụng hệ thống được ký bằng platform key, cho phép chúng có quyền truy cập đặc biệt hoặc được chạy cùng tiến trình. Điều này đảm bảo rằng các ứng dụng cài đặt sẵn được tin cậy và có quyền hạn cao.

### SELinux
Android tích hợp SELinux để thực thi chính sách kiểm soát truy cập bắt buộc (MAC), giúp ngăn chặn các hành động trái phép dựa trên các policy được định sẵn, nhằm bảo vệ hệ thống từ cấp độ kernel.

### Verified Boot
Để đảm bảo an toàn trong quá trình khởi động, Android sử dụng cơ chế Verified Boot dựa trên verity (Linux Device Mapper). Hệ thống kiểm tra toàn vẹn của từng block dữ liệu để phát hiện thay đổi hoặc mã độc trong hệ điều hành, từ đó bảo vệ tính an toàn của thiết bị ngay từ khi khởi động​

### Google Play Protect
Giám sát các ứng dụng trong cửa hàng và thiết bị để phát hiện phần mềm độc hại. Nó cung cấp khả năng bảo vệ thời gian thực, tự động quét các ứng dụng đã được cài đặt và phát hiện các hoạt động đáng ngờ.
## 4. REFERENCES
[1]. https://medium.com/@realm3ter/android-pentesting-1-anroid-architectures-f0f3d90ec109

[2]. https://www.geeksforgeeks.org/android-architecture/
